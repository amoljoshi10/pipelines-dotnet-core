jobs:

- job: buildandtest
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  # publish an artifact called drop
  - task: PublishBuildArtifacts@1
    inputs:
      artifactName: drop

  # deploy to Azure Web App staging
  - task: AzureWebApp@1
    inputs:
      azureSubscription: capgeminiaz400Devops26(87fce128-be33-4930-bafe-f9510c10e637)'
      appType: 'webApp'
      appName: 'WebAppDotNetCoreDemo21Staging'

- job: deploy
  pool:
    vmImage: 'ubuntu-latest'
  dependsOn: buildandtest
  condition: succeeded()
  steps:

  # download the artifact drop from the previous job
  - task: DownloadBuildArtifacts@0
    inputs:
      artifactName: drop

  # deploy to Azure Web App production
  - task: AzureWebApp@1
    inputs:
      azureSubscription: 'capgeminiaz400Devops26(87fce128-be33-4930-bafe-f9510c10e637)'
      appType: 'webApp'
      appName: 'WebAppDotNetCoreDemo21'